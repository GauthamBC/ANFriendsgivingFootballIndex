<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Top 10 Cities ‚Äî Friendsgiving Football Watch Party Index</title>
</head>

<body style="margin:0;">

<section class="fg-compact-embed keep-desktop" role="region" aria-labelledby="fg-compact-embed-title"
  style="max-width:920px;margin:16px auto;font:14px/1.35 Inter,system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
         color:#181a1f;background:#ffffff;border:1px solid #DCEFE6;border-radius:12px;
         box-shadow:0 1px 2px rgba(0,0,0,.04),0 6px 16px rgba(86,194,87,.10);">
  <style>
    /* === SCOPING PATCH ============================================== */
    section.fg-compact-embed, section.fg-compact-embed * {
      box-sizing: border-box;
      font-family: inherit;
      color: inherit;
    }
    section.fg-compact-embed { color-scheme: light; }
    /* ================================================================= */

    .fg-compact-embed{
      --brand-50:#F6FFF9; --brand-100:#DCF2EB; --brand-300:#BCE5D6;
      --brand-500:#56C257; --brand-600:#3FA94B; --brand-700:#2E8538; --brand-900:#1F5D28;
      --ink:#181a1f; --muted:#666b73; --border:#DCEFE6;
      --hover-tint: rgba(86,194,87,.12); --hover-ring:#BCE5D6; --hover-shadow:0 10px 24px rgba(86,194,87,.18);
      --pane-max-h: min(72vh, 640px); /* used only for mobile table scroll */
    }

    /* Header */
    .fg-compact-embed .head{
      padding:14px 16px;border-bottom:1px solid var(--border)!important;color:#fff!important;
      background:
        radial-gradient(120% 140% at 85% 10%, rgba(255,255,255,.10) 0%, transparent 60%),
        linear-gradient(90deg,var(--brand-900) 0%,var(--brand-600) 45%,var(--brand-500) 100%)!important;
      text-align:center;
    }
    .fg-compact-embed .title{
      margin:0 0 2px;
      font-size:clamp(16px,2.2vw,20px);
      line-height:1.2;
      font-weight:800;
      color:#fff!important;
    }
    .fg-compact-embed .sub{
      margin:0;
      color:rgba(255,255,255,.92)!important;
      font-size:12px;
    }
    .fg-sub{margin:0;color:rgba(255,255,255,.92);font-size:12px}
    .fg-sub strong { color:#ECFFF4!important; font-weight:900 }

    /* === HORIZONTAL SCROLL WRAPPER (mobile only) ====================== */

    /* Default (tablet/desktop): no horizontal scroll, no forced width */
    .fg-compact-embed .fg-scroll { overflow-x: visible; }
    .fg-compact-embed .fg-scroll-inner { min-width: auto; }

    /* Mobile: enable horizontal scroll + force a desktop-width canvas */
    @media (max-width: 640px){
      .fg-compact-embed .fg-scroll{
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-gutter: stable both-edges;
      }
      .fg-compact-embed .fg-scroll-inner{
        min-width: 900px;
      }
    
      .fg-compact-embed .fg-scroll::-webkit-scrollbar{ height:10px; }
      .fg-compact-embed .fg-scroll::-webkit-scrollbar-track{
        background: var(--brand-50); border-radius: 999px;
      }
      .fg-compact-embed .fg-scroll::-webkit-scrollbar-thumb{
        background: linear-gradient(90deg,var(--brand-600),var(--brand-500));
        border-radius: 999px; border: 2px solid #fff;
      }
    }

    /* Table / rows */
    .fg-compact-embed .table{padding:10px 12px}
    .fg-compact-embed .row{
      display:grid;grid-template-columns:40px 1fr minmax(240px,48%);
      gap:50px;
      align-items:center;margin:8px 0;
      border:1px solid var(--border)!important;border-radius:12px;padding:10px 12px;background:#fff!important;
      transition:transform .18s cubic-bezier(.2,.8,.2,1),box-shadow .18s ease,background-color .15s ease,border-color .15s ease;
      transform-origin:center; cursor:pointer;
    }
    .fg-compact-embed .row:hover,.fg-compact-embed .row:focus-within{
      background:linear-gradient(0deg,var(--hover-tint),var(--hover-tint)),#fff!important;
      transform:scale(1.01);box-shadow:var(--hover-shadow);border-color:var(--hover-ring)!important;
    }

    /* Keep desktop grid on mobile */
    @media (max-width:640px){
      .fg-compact-embed.keep-desktop .row{
        grid-template-columns:40px 1fr minmax(240px,48%);
        gap:50px;
      }
      .fg-compact-embed.keep-desktop .metric{ grid-column:auto; }
    }

    .fg-compact-embed .rank{
      display:flex;align-items:center;justify-content:center;
      font-weight:800;color:#475a50;
    }
    .fg-compact-embed .place{
      display:flex;align-items:center;gap:10px;
      font-weight:800;color:var(--ink);
    }
    .fg-compact-embed .chip{
      width:26px;height:18px;border-radius:4px;overflow:hidden;
      border:1px solid #cfe4da;background:#fff;flex-shrink:0;
    }
    .fg-compact-embed .chip img{
      width:100%;height:100%;object-fit:contain;display:block;
    }

    /* Metric bar (top-level index) */
    .fg-compact-embed .metric{
      position:relative;height:28px;border-radius:999px;
      background:rgba(86,194,87,.10)!important;overflow:hidden;
    }
    .fg-compact-embed .bar{
      position:absolute;inset:0 auto 0 0;border-radius:999px;
      background:linear-gradient(90deg,var(--brand-600),var(--brand-500))!important;
      box-shadow:inset 0 0 0 1px rgba(0,0,0,.04);
    }
    .fg-compact-embed .val{
      position:absolute;right:6px;top:50%;transform:translateY(-50%);
      font-variant-numeric:tabular-nums;font-weight:800;font-size:13px;
      color:#0e1a12!important;background:#fff!important;border:2px solid #e6e9ed!important;
      border-radius:999px;padding:2px 8px;
    }

    /* Rank-based gradient dark ‚Üí light (1‚Äì10) */
    .fg-compact-embed .row[data-rank="1"] .bar{background:linear-gradient(90deg,#1F5D28,#56C257)!important}
    .fg-compact-embed .row[data-rank="2"] .bar{background:linear-gradient(90deg,#2A7331,#5DC65F)!important}
    .fg-compact-embed .row[data-rank="3"] .bar{background:linear-gradient(90deg,#2E8538,#63CA67)!important}
    .fg-compact-embed .row[data-rank="4"] .bar{background:linear-gradient(90deg,#379744,#6ACE70)!important}
    .fg-compact-embed .row[data-rank="5"] .bar{background:linear-gradient(90deg,#3FA94B,#71D279)!important}
    .fg-compact-embed .row[data-rank="6"] .bar{background:linear-gradient(90deg,#52B760,#7AD783)!important}
    .fg-compact-embed .row[data-rank="7"] .bar{background:linear-gradient(90deg,#64C274,#84DB8E)!important}
    .fg-compact-embed .row[data-rank="8"] .bar{background:linear-gradient(90deg,#76CC88,#8FE099)!important}
    .fg-compact-embed .row[data-rank="9"] .bar{background:linear-gradient(90deg,#8AD79D,#9AE5A5)!important}
    .fg-compact-embed .row[data-rank="10"] .bar{background:linear-gradient(90deg,#9FE1B3,#A7E6BA)!important}

    /* Details (expand/collapse) */
    .fg-details{
      margin:0;border:1px solid var(--border);border-width:0;border-radius:12px;background:var(--brand-50);
      max-height:0;opacity:0;overflow:hidden;transform:translateY(-6px);
      transition:max-height .28s ease, opacity .28s ease, transform .28s ease, border-width .18s ease, padding .18s ease, margin .18s ease;
    }
    .fg-details.open{
      margin:8px 0 12px;padding:12px;border-width:1px;
      max-height:420px;opacity:1;transform:translateY(0);
    }
    .fg-metrics-title {
      margin: 0 0 10px;
      font-weight: 900 !important;
      font-size: 16px;
      color: var(--brand-700) !important;
      display: flex; align-items: center; gap: 8px;
    }
    .fg-metrics{
      display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;
    }
    @media (max-width:640px){
      .fg-compact-embed.keep-desktop .fg-metrics{
        grid-template-columns:repeat(3,minmax(0,1fr));
      }
    }

    .fg-card{
      background:#fff;border:1px solid var(--border);border-radius:10px;
      padding:12px;display:grid;grid-template-rows:auto auto auto;gap:8px;
    }
    .fg-card-head{display:flex;align-items:center;gap:8px}

    .fg-label{
      font-size:14px !important;
      line-height:1.15;
      color: var(--ink);
      font-weight:900 !important;
      letter-spacing:.1px;
    }

    .fg-val{display:flex;align-items:baseline;gap:2px}
    .fg-val-main{font-size:20px;font-weight:800;color:var(--ink)}
    .fg-val-max{font-size:11px;font-weight:600;color:var(--muted)}

    .fg-bar{height:8px;border-radius:999px;background:rgba(86,194,87,.18);overflow:hidden}
    .fg-bar > span{
      display:block;height:100%;width:0;border-radius:999px;
      background:linear-gradient(90deg,var(--brand-600),var(--brand-500));
      transition:width .5s ease;
    }

    /* Icon sizing */
    .fg-icon{width:22px;height:22px;flex:0 0 22px;display:inline-block}

    /* Sleek internal vertical scroll (MOBILE ONLY) */
    @media (max-width:640px){
      .fg-compact-embed .table{
        max-height: var(--pane-max-h);
        overflow:auto;
        -webkit-overflow-scrolling:touch;
        overscroll-behavior:auto;
        scrollbar-gutter:stable both-edges;
      }
      .fg-compact-embed .table::-webkit-scrollbar{ width:10px; height:8px }
      .fg-compact-embed .table::-webkit-scrollbar-track{ background:var(--brand-50); border-radius:999px }
      .fg-compact-embed .table::-webkit-scrollbar-thumb{
        background:linear-gradient(180deg,var(--brand-600),var(--brand-500));
        border-radius:999px; border:2px solid #fff;
      }
      .fg-compact-embed .table::-webkit-scrollbar-thumb:hover{
        background:linear-gradient(180deg,var(--brand-700),var(--brand-600));
      }
      .fg-compact-embed .table{
        scrollbar-width:thin;
        scrollbar-color:var(--brand-600) var(--brand-50);
      }
    }

    /* Footer */
    .fg-compact-embed .fg-footer {
      display:block !important;
      text-align:center;
      padding:8px 0;
      border-top:1px solid var(--border);
      background:
        radial-gradient(120% 140% at 85% 10%, rgba(255,255,255,.10) 0%, transparent 60%),
        linear-gradient(90deg,var(--brand-900) 0%,var(--brand-600) 45%,var(--brand-500) 100%)!important;
      color:#fff;
      position:relative;
      overflow:visible;
    }
    .fg-compact-embed .footer-inner{
      display:grid;
      grid-template-columns:1fr auto 1fr; /* left = embed, center = logo, right = download */
      align-items:center;
      padding:0 14px;
      gap:12px;
    }

    /* Export-only layout: center logo when buttons are hidden */
    .fg-compact-embed.exporting .footer-inner{
      grid-template-columns: 1fr;
      justify-items: center;
    }
    .fg-compact-embed.exporting .fg-footer img{
      grid-column:1 / -1;
      margin:0 auto;
    }

    .fg-compact-embed .embed-btn{
      justify-self:start;
      background:#56C257;
      color:#fff;
      border:1px solid #56C257;
      border-radius:8px;
      padding:6px 14px;
      font:13px/1.2 system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;
      cursor:pointer;
      transition:.2s ease;
    }
    .fg-compact-embed .embed-btn:hover{
      background:#3FA94B;
      border-color:#3FA94B;
    }

    .fg-compact-embed .download-btn{
      justify-self:end;
      background:#56C257;
      color:#fff;
      border:1px solid #56C257;
      border-radius:8px;
      padding:6px 14px;
      font:13px/1.2 system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;
      cursor:pointer;
      transition:.2s ease;
    }
    .fg-compact-embed .download-btn:hover{
      background:#3FA94B;
      border-color:#3FA94B;
    }

    /* Hide action buttons AND flag chips when exporting */
    .fg-compact-embed.exporting .embed-btn,
    .fg-compact-embed.exporting .download-btn,
    .fg-compact-embed.exporting .chip{
      display:none !important;
    }

    .fg-compact-embed .fg-footer img{
      height:52px;
      width:auto;
      display:block;
      margin:0 auto;
      filter:brightness(0) invert(1);
    }

    .fg-compact-embed .embed-wrapper{
      position:absolute;bottom:calc(100% + 10px);left:50%;transform:translateX(-50%);
      width:min(600px, calc(100% - 24px));display:none;
      padding:16px 20px;border:1px solid #ccc;border-radius:12px;
      background:#fff;color:#111;
      box-shadow:0 12px 28px rgba(0,0,0,.18);z-index:1000;
    }
    .fg-compact-embed .embed-wrapper::after{
      content:""; position:absolute; left:50%; transform:translateX(-50%); bottom:-8px;
      border:8px solid transparent; border-top-color:#fff;
      filter: drop-shadow(0 1px 1px rgba(0,0,0,.08));
    }
    .fg-compact-embed #copy-status{
      display:none;color:#008000;font-size:13px;margin-top:6px;
    }
    .fg-compact-embed .embed-wrapper textarea{
      width:100%;height:140px;
      font:14px/1.45 ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace;
      color:#111;background:#fff;
      padding:10px 12px;border:1px solid #ddd;border-radius:8px;resize:none;
    }

    /* Mobile footer tweaks */
    @media (max-width:640px){
      .fg-compact-embed .footer-inner{
        padding:0 10px;
        gap:8px;
      }
      .fg-compact-embed .embed-btn,
      .fg-compact-embed .download-btn{
        padding:6px 10px;
        font-size:12px;
        line-height:1.2;
      }
      .fg-compact-embed .fg-footer img{
        height:44px;
      }
    }

    /* Table header row (sortable) */
    .fg-compact-embed .table-header{
      display:grid;
      grid-template-columns:40px 1fr minmax(240px,48%);
      gap:84px;
      padding:10px 12px;
      margin:8px 12px 0;
      font-size:16px;
      font-weight:800;
      color:var(--brand-700);
      text-shadow:0 0 1px rgba(47,133,56,.2), 0 0 8px rgba(86,194,87,.25);
      border-radius:10px;
    }
    @media (max-width:640px){
      .fg-compact-embed.keep-desktop .table-header{
        grid-template-columns:40px 1fr minmax(240px,48%);
        gap:84px;
      }
    }

    .fg-compact-embed .table-header .h-rank,
    .fg-compact-embed .table-header .h-city {
      display:flex; align-items:center; justify-content:flex-start;
    }
    .fg-compact-embed .table-header .h-city {
      padding-left:6px;
    }
    .fg-compact-embed .table-header .h-index {
      display:flex; align-items:center; justify-content:center; text-align:center;
    }

    .fg-compact-embed .sortable{
      cursor:pointer; user-select:none; position:relative;
    }
    .fg-compact-embed .sortable:focus{
      outline:2px solid var(--brand-300);
      outline-offset:2px; border-radius:6px;
    }
    .fg-compact-embed .sortable::after{
      content:""; margin-left:8px; border:5px solid transparent;
      opacity:.35; border-top-color:var(--brand-700); transform:translateY(2px);
    }
    .fg-compact-embed .sortable[data-sort-dir="asc"]::after{
      border-bottom-color:var(--brand-700);
      transform:translateY(-2px) rotate(180deg);
      opacity:1;
    }
    .fg-compact-embed .sortable[data-sort-dir="desc"]::after{
      border-top-color:var(--brand-700);
      transform:translateY(2px);
      opacity:1;
    }
  </style>

  <!-- HEADER -->
  <div class="head">
    <h3 id="fg-compact-embed-title" class="title">
      Top 10 Cities for a Friendsgiving Football Watch Party
    </h3>
    <p class="fg-sub">
      <em>
        Click a city to view its <strong>Sports Access Score</strong>, <strong>Affordability Score</strong>, and <strong>Atmosphere Score</strong>
      </em>
    </p>
  </div>

  <!-- HORIZONTAL SCROLL AREA (keeps desktop layout on mobile) -->
  <div class="fg-scroll" role="group" aria-label="Scrollable table region">
    <div class="fg-scroll-inner">

      <!-- TABLE HEADER (sortable labels) -->
      <div class="table-header" role="row">
        <div class="h-rank sortable"  role="button" tabindex="0" aria-label="Sort by Rank" data-sort-key="rank" data-sort-dir="">
          <span>Rank</span>
        </div>
        <div class="h-city sortable"  role="button" tabindex="0" aria-label="Sort by City" data-sort-key="city" data-sort-dir="">
          <span>City</span>
        </div>
        <div class="h-index sortable" role="button" tabindex="0" aria-label="Sort by Friendsgiving Football Index" data-sort-key="index" data-sort-dir="">
          <span>Friendsgiving Football Index (0‚Äì100)</span>
        </div>
      </div>

      <!-- TABLE BODY -->
      <div class="table" id="fg-table"><!-- Rows injected by script --></div>

    </div>
  </div>

  <!-- FOOTER -->
  <div class="fg-footer">
    <div class="footer-inner">
      <!-- Left: Embed button -->
      <button id="copy-embed-btn" class="embed-btn" aria-controls="embed-wrapper" aria-expanded="false">
        üîó Embed This Table
      </button>

      <!-- Centre: Action Network logo -->
      <img
        src="https://i.postimg.cc/x1nG117r/AN-final2-logo.png"
        alt="The Action Network logo"
        width="120"
        height="auto"
        loading="lazy"
        decoding="async"
      />

      <!-- Right: Download image button -->
      <button id="download-img-btn" class="download-btn">
        ‚¨áÔ∏è Download Image
      </button>
    </div>

    <div id="embed-wrapper" class="embed-wrapper" role="dialog" aria-modal="false">
      <textarea id="embed-code" readonly>&lt;iframe 
  src="https://gauthambc.github.io/ANFriendsgivingFootballIndex/top10cities.html"
  title="Top 10 Cities for a Friendsgiving Football Watch Party"
  width="100%" height="880"
  scrolling="no"
  style="border:0;" loading="lazy"&gt;&lt;/iframe&gt;</textarea>
      <p id="copy-status">Embed code copied!</p>
    </div>
  </div>

  <script>
    (function(){
      /* ---- Data (top 10 with sub-metrics; bars scale 0‚Äì100) ---- */
      const TOP10 = [
        {rank:1,  city:"Green Bay, WI",      state:"WI", index:61.52, sports:72.34, affordability:74.04, atmosphere:26.69},
        {rank:2,  city:"Houston, TX",        state:"TX", index:56.93, sports:50.58, affordability:55.97, atmosphere:68.42},
        {rank:3,  city:"Cleveland, OH",      state:"OH", index:52.32, sports:60.25, affordability:61.23, atmosphere:27.18},
        {rank:4,  city:"Baltimore, MD",      state:"MD", index:52.31, sports:54.81, affordability:52.23, atmosphere:48.42},
        {rank:5,  city:"Pittsburgh, PA",     state:"PA", index:52.20, sports:56.34, affordability:65.57, atmosphere:26.85},
        {rank:6,  city:"Cincinnati, OH",     state:"OH", index:51.80, sports:56.98, affordability:62.10, atmosphere:29.08},
        {rank:7,  city:"Jacksonville, FL",   state:"FL", index:51.46, sports:50.80, affordability:57.36, atmosphere:44.24},
        {rank:8,  city:"Atlanta, GA",        state:"GA", index:50.44, sports:52.54, affordability:48.69, atmosphere:49.51},
        {rank:9,  city:"Indianapolis, IN",   state:"IN", index:50.24, sports:52.34, affordability:57.83, atmosphere:36.25},
        {rank:10, city:"Philadelphia, PA",   state:"PA", index:50.13, sports:51.48, affordability:49.45, atmosphere:48.94}
      ];

      /* Keep a copy for default (unsorted) render */
      const ORIGINAL = TOP10.slice();

      /* Flags */
      const FLAGS = {
        "WI":"Flag_of_Wisconsin.svg",
        "TX":"Flag_of_Texas.svg",
        "OH":"Flag_of_Ohio.svg",
        "MD":"Flag_of_Maryland.svg",
        "PA":"Flag_of_Pennsylvania.svg",
        "FL":"Flag_of_Florida.svg",
        "GA":"Flag_of_Georgia_(U.S._state).svg",
        "IN":"Flag_of_Indiana.svg"
      };

      /* Icons */
      const ICONS = {
        sports: () => `
          <svg class="fg-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="#2E8538" d="M7 3h10v3a5 5 0 0 1-4 4.9V13h3a4 4 0 0 1 4 4v1H4v-1a4 4 0 0 1 4-4h3V10.9A5 5 0 0 1 7 6z"/>
            <path fill="#56C257" d="M17 3v2a3 3 0 1 0 0-2zM7 3v2a3 3 0 1 1 0-2z"/>
          </svg>
        `,
        affordability: () => `
          <svg class="fg-icon" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="12" cy="12" r="10" fill="#DCF2EB"/>
            <path fill="#3FA94B" d="M12 5a1 1 0 0 1 1 1v1.05c1.96.23 3.5 1.31 3.5 2.95 0 1.92-1.86 2.73-3.9 3.2-1.78.41-2.6.77-2.6 1.5 0 .66.77 1.16 2 1.16 1.04 0 1.93-.3 2.6-.78l.78 1.6c-.77.54-1.86.9-3.08 1.02V19a1 1 0 1 1-2 0v-1.03c-2.03-.25-3.5-1.35-3.5-2.9 0-1.9 1.83-2.68 3.8-3.13 1.86-.42 2.7-.82 2.7-1.56 0-.72-.85-1.2-2.07-1.2-1.06 0-2 .34-2.76.9l-.84-1.56C9.2 7 10.49 6.6 11.94 6.48V6a1 1 0 0 1 1-1z"/>
          </svg>
        `,
        atmosphere: (uid) => `
          <svg class="fg-icon" viewBox="0 0 24 24" aria-hidden="true">
            <defs>
              <linearGradient id="atm-g-${uid}" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="#3FA94B"/><stop offset="100%" stop-color="#56C257"/>
              </linearGradient>
            </defs>
            <path fill="url(#atm-g-${uid})" d="M13 3a3 3 0 0 0-6 0v8.59A5 5 0 1 0 13 16zM8 3a1 1 0 1 1 2 0v7H8z"/>
            <circle cx="16.5" cy="15.5" r="3.5" fill="#BCE5D6"/>
          </svg>
        `
      };

      const table = document.getElementById('fg-table');

      /* Auto-resize messaging to parent (for iframe) */
      function sendHeightToParent() {
        try {
          const height = document.body.scrollHeight;
          window.parent.postMessage(
            { type: "resize-iframe", height: height, src: window.location.href },
            "*"
          );
        } catch (e) {}
      }

      function makeDetails(item, flagURL){
        const d = document.createElement('div');
        d.className = 'fg-details';
        d.setAttribute('aria-hidden','true');

        const uid = `${item.state}-${item.rank}`;

        d.innerHTML = `
          <h4 class="fg-metrics-title">
            <span class="chip" style="width:26px;height:18px;border-radius:4px;overflow:hidden;border:1px solid #cfe4da;background:#fff">
              <img src="${flagURL}" alt="${item.state} state flag" style="width:100%;height:100%;object-fit:contain">
            </span>
            ${item.city} ‚Äî Key Scores
          </h4>
          <div class="fg-metrics">
            <div class="fg-card">
              <div class="fg-card-head">
                ${ICONS.sports()}
                <div class="fg-label">Sports Access Score</div>
              </div>
              <div class="fg-val">
                <span class="fg-val-main">${item.sports.toFixed(2)}</span>
                <span class="fg-val-max">/100</span>
              </div>
              <div class="fg-bar"><span></span></div>
            </div>
            <div class="fg-card">
              <div class="fg-card-head">
                ${ICONS.affordability()}
                <div class="fg-label">Affordability Score</div>
              </div>
              <div class="fg-val">
                <span class="fg-val-main">${item.affordability.toFixed(2)}</span>
                <span class="fg-val-max">/100</span>
              </div>
              <div class="fg-bar"><span></span></div>
            </div>
            <div class="fg-card">
              <div class="fg-card-head">
                ${ICONS.atmosphere(uid)}
                <div class="fg-label">Atmosphere Score</div>
              </div>
              <div class="fg-val">
                <span class="fg-val-main">${item.atmosphere.toFixed(2)}</span>
                <span class="fg-val-max">/100</span>
              </div>
              <div class="fg-bar"><span></span></div>
            </div>
          </div>
        `;
        return d;
      }

      function makeRow(item){
        const row = document.createElement('div');
        row.className = 'row';
        row.dataset.rank = String(item.rank);
        row.setAttribute('role','button');
        row.setAttribute('tabindex','0');
        row.setAttribute('aria-expanded','false');

        const flagURL = `https://commons.wikimedia.org/wiki/Special:FilePath/${FLAGS[item.state]}`;
        const pct = Math.max(0, Math.min(100, item.index));
        const valText = `${item.index.toFixed(2)} / 100`;

        row.innerHTML = `
          <div class="rank">${item.rank}</div>
          <div class="place">
            <span class="chip">
              <img loading="lazy" decoding="async" alt="${item.state} state flag" width="26" height="18" src="${flagURL}">
            </span>
            <span>${item.city}</span>
          </div>
          <div class="metric">
            <span class="bar" style="width:${pct.toFixed(2)}%"></span>
            <span class="val">${valText}</span>
          </div>
        `;

        const details = makeDetails(item, flagURL);
        row._fgDetails = details;

        function open(){
          // close any other open rows
          document.querySelectorAll('.fg-compact-embed .row[aria-expanded="true"]').forEach(r=>{
            if(r!==row){
              r.setAttribute('aria-expanded','false');
              const d = r._fgDetails;
              if(d && d.classList.contains('fg-details')){
                d.classList.remove('open');
                d.setAttribute('aria-hidden','true');
                d.querySelectorAll('.fg-bar > span').forEach(s=> s.style.width='0');
              }
            }
          });

          row.setAttribute('aria-expanded','true');
          details.classList.add('open');
          details.setAttribute('aria-hidden','false');

          details.querySelectorAll('.fg-card').forEach(card=>{
            const v = parseFloat(card.querySelector('.fg-val-main').textContent);
            const bar = card.querySelector('.fg-bar > span');
            requestAnimationFrame(()=> bar.style.width = `${Math.max(0,Math.min(100,v))}%`);
          });

          sendHeightToParent();
          details.scrollIntoView({block:'nearest', behavior:'smooth'});
        }

        function close(){
          row.setAttribute('aria-expanded','false');
          details.classList.remove('open');
          details.setAttribute('aria-hidden','true');
          details.querySelectorAll('.fg-bar > span').forEach(s=> s.style.width='0');
        }

        row.addEventListener('click', ()=>{
          const openNow = row.getAttribute('aria-expanded') === 'true';
          openNow ? close() : open();
        });

        row.addEventListener('keydown', e=>{
          if(e.key==='Enter' || e.key===' '){
            e.preventDefault();
            const openNow = row.getAttribute('aria-expanded') === 'true';
            openNow ? close() : open();
          }
        });

        return {row, details};
      }

      /* Render */
      function renderTable(data){
        table.innerHTML = "";
        data.forEach(item=>{
          const {row, details} = makeRow(item);

          // Top 5: expand BELOW row; bottom 5: expand ABOVE row
          if (item.rank <= 5) {
            table.appendChild(row);
            table.appendChild(details);
          } else {
            table.appendChild(details);
            table.appendChild(row);
          }
        });
        sendHeightToParent();
      }

      /* Initial render: ORIGINAL order (no sorting until user clicks) */
      renderTable(ORIGINAL);

      window.addEventListener("load", sendHeightToParent);
      window.addEventListener("resize", sendHeightToParent);
      const observer = new MutationObserver(sendHeightToParent);
      observer.observe(document.body, { childList: true, subtree: true, attributes: true });

      /* Sorting (only after header clicks) */
      const headers = document.querySelectorAll('.table-header .sortable');

      function sortData(key, dir){
        const arr = ORIGINAL.slice();
        const collator = new Intl.Collator(undefined, { sensitivity: 'base', numeric: true });
        arr.sort((a,b)=>{
          let res = 0;
          if (key === 'city') {
            res = collator.compare(a.city, b.city);
          } else if (key === 'rank' || key === 'index') {
            res = (a[key] < b[key]) ? -1 : (a[key] > b[key]) ? 1 : 0;
          }
          return dir === 'asc' ? res : -res;
        });
        return arr;
      }

      function clearHeaderStates(){
        headers.forEach(h=> h.setAttribute('data-sort-dir',''));
      }

      function onHeaderActivate(el){
        const key = el.getAttribute('data-sort-key');
        let dir = el.getAttribute('data-sort-dir');
        dir = (dir === 'asc') ? 'desc' : 'asc';
        clearHeaderStates();
        el.setAttribute('data-sort-dir', dir);
        const sorted = sortData(key, dir);
        renderTable(sorted);
      }

      headers.forEach(h=>{
        h.addEventListener('click', ()=> onHeaderActivate(h));
        h.addEventListener('keydown', (e)=>{
          if(e.key==='Enter' || e.key===' '){
            e.preventDefault();
            onHeaderActivate(h);
          }
        });
      });

      /* Footer embed popup & copy */
      const btn     = document.getElementById('copy-embed-btn');
      const wrapper = document.getElementById('embed-wrapper');
      const ta      = document.getElementById('embed-code');
      const status  = document.getElementById('copy-status');

      if (btn && ta && wrapper && status) {
        btn.addEventListener('click', () => {
          const isHidden = wrapper.style.display === 'none' || wrapper.style.display === '';
          wrapper.style.display = isHidden ? 'block' : 'none';
          btn.textContent = isHidden ? 'Hide Embed Code' : 'üîó Embed This Table';
          btn.setAttribute('aria-expanded', String(isHidden));
          if (isHidden) {
            ta.focus(); ta.select();
            try { document.execCommand('copy'); } catch(e) {}
            status.style.display = 'block';
            setTimeout(() => status.style.display = 'none', 2500);
          } else {
            btn.focus();
          }
          sendHeightToParent();
        });

        document.addEventListener('click', (e)=>{
          const open = wrapper.style.display === 'block';
          if (open && !wrapper.contains(e.target) && !btn.contains(e.target)) {
            wrapper.style.display = 'none';
            btn.setAttribute('aria-expanded','false');
            btn.textContent = 'üîó Embed This Table';
            sendHeightToParent();
          }
        });

        document.addEventListener('keydown', (e)=>{
          if (e.key === 'Escape' && wrapper.style.display === 'block') {
            wrapper.style.display = 'none';
            btn.setAttribute('aria-expanded','false');
            btn.textContent = 'üîó Embed This Table';
            btn.focus();
            sendHeightToParent();
          }
        });
      }
    })();
  </script>
</section>

<!-- High-resolution image export -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const btn = document.getElementById("download-img-btn");
  if (!btn) return;

  btn.addEventListener("click", function () {
    const target = document.querySelector(".fg-compact-embed");
    if (!target) return;

    // Hide action buttons + flags for export
    target.classList.add("exporting");

    html2canvas(target, {
      scale: 4,
      useCORS: true,
      backgroundColor: null
    }).then(canvas => {
      const link = document.createElement("a");
      link.download = "Friendsgiving_Top10.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    }).catch(() => {
      // ignore errors
    }).finally(() => {
      // Restore interactive state
      target.classList.remove("exporting");
    });
  });
});
</script>

</body>
</html>
